@{
    ViewData["Title"] = "Carte des vols";
}

<h2>Carte des vols</h2>

<div id="map" style="height: 600px; width: 100%; margin-bottom: 20px;"></div>

<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
    // 1. Initialisation de la carte centrée par défaut sur Casablanca
    const map = L.map('map').setView([33.5731, -7.5898], 7);

    // 2. Fond de carte OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    // 3. Chargement des lignes de vols depuis le contrôleur
    fetch('/Carte/GetVolsGeoJson')
        .then(response => response.json())
        .then(data => {
            const geoLayer = L.geoJSON(data, {
                style: {
                    color: 'red',
                    weight: 5,
                    opacity: 0.9
                },
                onEachFeature: function (feature, layer) {
                    const props = feature.properties;
                    layer.bindPopup(`
                        <b>${props.depart} → ${props.destination}</b><br/>
                        Date : ${props.date_vol}<br/>
                        Places : ${props.places}
                    `);
                }
            }).addTo(map);

            // 4. Centrage automatique sur les lignes
            map.fitBounds(geoLayer.getBounds());
        })
        .catch(error => {
            console.error('Erreur lors du chargement des données GeoJSON :', error);
        });
</script>
